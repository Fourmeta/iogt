{% load static wagtailuserbar home_tags sass_tags wagtailsettings_tags menu_tags %}
{% get_settings %}

<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <script async
            src="https://www.googletagmanager.com/gtag/js?id={{ settings.home.SiteSettings.local_ga_tracking_code }}"></script>
    <script>
		window.dataLayer = window.dataLayer || [];

		function gtag() {
			window.dataLayer.push(arguments);
		}

		gtag('js', new Date());
		gtag('config', '{{ settings.home.SiteSettings.local_ga_tag_manager }}');
		gtag('config', '{{ settings.home.SiteSettings.global_ga_tag_manager }}');
		gtag('config', '{{ settings.home.SiteSettings.local_ga_tracking_code }}');
		gtag('config', '{{ settings.home.SiteSettings.global_ga_tracking_code }}');
    </script>
    <meta charset="utf-8"/>
    <title>
        {% block title %}
            {% if self.seo_title %}{{ self.seo_title }}{% else %}
                {{ self.title }}{% endif %}
        {% endblock %}
        {% block title_suffix %}
            {% with self.get_site.site_name as site_name %}
                {% if site_name %}- {{ site_name }}{% endif %}
            {% endwith %}
        {% endblock %}
    </title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="theme-color" content="#493174">
    <link rel="manifest" href="{% url "manifest" %}">
    <link rel="apple-touch-icon" href="{% static 'icons/unicef-logo.png' %}">

    {# Global stylesheets #}
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" type="text/css" href="{% static 'css/iogt.css' %}">
    <link rel="stylesheet" type="text/css"
          href="{% sass_src 'css/sectionStyles.css' %}">

    {% block extra_css %}
        {# Override this in templates to add extra stylesheets #}
    {% endblock %}
</head>

<body class="{% block body_class %}{% endblock %}">
{% wagtailuserbar %}

<main id="app">
    <div id="content-wrap">
        {% if settings.home.CacheSettings.cache and first_time_user %}
            {% include "cache_banner.html" %}
        {% endif %}
        {% include "header.html" %}
        {% include "messages.html" %}
        <div class="page">
            <div class="page__sidebar">
                <div class="sidebar">
                    <div class="container container--main"><a href="#"
                                                              class="icon-btn sidebar__item"><span
                            class="icon-btn__icon"><img
                            src="images/icons/finger_up.svg"
                            alt="Heart icon"> </span><span
                            class="icon-btn__title">Are you a fan of IoGT?</span>
                    </a><a
                            href="#" class="icon-btn sidebar__item"><span
                            class="icon-btn__icon"><img
                            src="images/icons/loud_speaker.svg"
                            alt="Heart icon"> </span><span
                            class="icon-btn__title">About Internet of Good Things</span>
                    </a><a href="#" class="icon-btn sidebar__item"><span
                            class="icon-btn__icon"><img
                            src="images/icons/wifi_aerial.svg" alt="Heart icon"> </span><span
                            class="icon-btn__title">Use IoGT FREE of data charges</span></a>
                    </div>
                </div>
            </div>
            <div class="page__content">
                {% block content %}{% endblock %}
            </div>
            {% include "footer.html" %}
        </div>
    </div>
</main>

{# Global javascript #}
<script>

	const failMsg = 'Something went wrong. Can you try refreshing the page, and clicking the download website button?';
	const successMsg = "Your app is now ready to install. If you are using a iOS device, you can install it by clicking 'Share', scrolling down and tapping 'Add to Home Screen. If using Android choose 'Add to home screen' and you should be all set!";

	async function cache() {
		if ('serviceWorker' in navigator && confirm("Install this website as an app on your device?") === true) {
			try {
				await navigator.serviceWorker.register('{% url "sw.js" %}', {scope: '/'});
				alert(successMsg);
			} catch {
				alert(failMsg);
			}
		}
	}
</script>
<noscript>
    <style type="text/css">
        #hideOnNonJSDevice, .hideOnNonJSDevice {
            display: none;
        }

        .showOnNonJSDevice {
            display: block !important;
        }
    </style>
</noscript>
{% block extra_js %}{% endblock %}
</body>
</html>
